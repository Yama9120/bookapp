document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("geocode-form");let r=document.getElementById("keyword-input"),o=document.getElementById("geocode-result"),n="<%= baseUrl %>";function t(e){return console.log("取得したgeocode:",e),e}function c(e){o.innerHTML=`<p class="error">${e}</p>`}e&&e.addEventListener("submit",function(e){e.preventDefault();var e=r.value;e?(e=e,fetch(n+"geocode?keyword="+encodeURIComponent(e)).then(e=>{if(e.ok)return e.json();throw new Error("ネットワークレスポンスが正常ではありません")}).then(e=>{if(console.log("APIからのレスポンス:",e),e.error)throw new Error(e.error);return e.geocode}).then(t).then(e=>{var r=e;return r=encodeURIComponent(e),fetch(n+"searchLibrary?geocode="+r).then(e=>{if(e.ok)return e.json();throw new Error("図書館データの取得に失敗しました")}).then(e=>{console.log("Library Search Results:",e);{o.innerHTML="";let n=document.createElement("div");n.innerHTML="<h3>近くの図書館</h3>",e.forEach(e=>{var r=document.createElement("div");r.innerHTML=`
                <p>名前: ${e.formal}</p>
                <p>住所: ${e.address}</p>
            `,n.appendChild(r)}),o.appendChild(n)}}).catch(e=>{console.error("Library search failed:",e),c("図書館データの取得に失敗しました")})}).catch(c)):c("キーワードを入力してください。")})});