<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">

        <link rel="stylesheet" href="<%= baseUrl %>styles/main.css">
        
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://calil.jp/public/js/calilapi.js"></script>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script src="https://calil.jp/public/js/calilapi.js"></script>

        <%- include('../partials/head'); %>
    </head>
     
    <body style="padding-top: 70px;">
        <div class="container"> 
            <header style="position: fixed; top: 0; left: 0; width: 100%; background-color: black; z-index: 1000;">
                <%- include('../partials/header') %>
            </header>
    
            <h1>Book Details</h1>
            <div id="book-details"></div>
            <div id="searchlibrary-container" style="display: none;">
                <%- include('../partials/searchlibrary') %>
            </div>
            <div id="book-description"></div>
        
            <script>
                const bookId = '<%= bookId %>';
                const apiUrl = `https://www.googleapis.com/books/v1/volumes/${bookId}`;
        
                async function loadBookDetails() {
                    try {
                        const response = await fetch(apiUrl);
                        const data = await response.json();
                        const volumeInfo = data.volumeInfo;
    
                        // 本の詳細を表示
                        document.getElementById('book-details').innerHTML = `
                            <h2>${volumeInfo.title}</h2>
                            <p>著者: ${volumeInfo.authors ? volumeInfo.authors.join(', ') : '著者不明'}</p>
                            <img src="${volumeInfo.imageLinks.thumbnail}" alt="${volumeInfo.title}の表紙">
                        `;
    
                        // searchlibrary.ejsを表示
                        document.getElementById('searchlibrary-container').style.display = 'block';
    
                        // 説明文を処理して表示
                        const description = volumeInfo.description || '説明文がありません。';
                        const processedDescription = description.replace(/\n/g, '<br>');
                        document.getElementById('book-description').innerHTML = `<p>${processedDescription}</p>`;
                    } catch (error) {
                        console.error('Error fetching book details:', error);
                    }
                }
    
                loadBookDetails();
            </script>
        </div>
    
        <footer class="mt-4 w-100">
            <%- include('../partials/footer') %>
        </footer>

        <script src="<%= baseUrl %>scripts/searchlibrary.js"></script>

    </body>
    
</html>